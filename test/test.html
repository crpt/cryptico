<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script
      language="JavaScript"
      type="text/javascript"
      src="../dist/cryptico.umd.js"
    ></script>
    <script>
      function print(string) {
        document.write(string + '\n\n')
      }

      print('<h1>Unsigned:</h1>')

      let PassPhrase = 'The Moon is a Harsh Mistress.'
      let Bits = 512

      print("Matt's passphrase: " + PassPhrase)
      print('Bit length: ' + Bits)

      const MattsRSAkey = cryptico.generateRSAKey(PassPhrase, Bits)
      const MattsPublicKeyString = cryptico.publicKeyString(MattsRSAkey)

      print("Matt's public key string:")
      print(MattsPublicKeyString)

      let PlainText =
        'Matt, I need you to encrypt UTF-8 strings which may include 中文字符.'

      print("Sam's message: " + PlainText)

      let EncryptionResult = cryptico.encrypt(PlainText, MattsPublicKeyString)

      print('The encrypted message:')
      print(EncryptionResult.cipher)

      let DecryptionResult = cryptico.decrypt(
        EncryptionResult.cipher,
        MattsRSAkey,
      )

      print('The decrypted message:')
      print(DecryptionResult.plaintext)
      print('DecryptionResult.signature: ' + DecryptionResult.signature)

      print('<h1>Signed, good signature:</h1>')

      PassPhrase = "There Ain't No Such Thing As A Free Lunch."
      Bits = 512
      const SamsRSAkey = cryptico.generateRSAKey(PassPhrase, Bits)
      EncryptionResult = cryptico.encrypt(
        PlainText,
        MattsPublicKeyString,
        SamsRSAkey,
      )

      print(
        "Sam's public key ID: " +
          cryptico.publicKeyID(cryptico.publicKeyString(SamsRSAkey)),
      )

      print('The encrypted message:')
      print(EncryptionResult.cipher)

      DecryptionResult = cryptico.decrypt(
        EncryptionResult.cipher,
        MattsRSAkey,
      )

      print('The decrypted message:')
      print(DecryptionResult.plaintext)

      print('DecryptionResult.signature: ' + DecryptionResult.signature)

      print('The signature public key string:')
      print(DecryptionResult.publicKeyString)

      print('The signature public key ID:')
      print(cryptico.publicKeyID(DecryptionResult.publicKeyString))

      /* TODO: fix forged signature test */
      print('<h1>Signed, forged signature:</h1>')

      const ForgersRSAkey = cryptico.generateRSAKey(PassPhrase, Bits)
      const ForgedEncryptionResult = cryptico.encrypt(
        PlainText,
        MattsPublicKeyString,
        ForgersRSAkey,
      )

      print(
        "Forger's public key ID: " +
          cryptico.publicKeyID(cryptico.publicKeyString(ForgersRSAkey)),
      )

      EncryptionResult.cipher = ForgedEncryptionResult.cipher

      print('The encrypted message:')
      print(EncryptionResult.cipher)

      DecryptionResult = cryptico.decrypt(
        EncryptionResult.cipher,
        MattsRSAkey,
      )

      print('The decrypted message:')
      print(DecryptionResult.plaintext)

      print('DecryptionResult.signature: ' + DecryptionResult.signature)

      print('The signature public key string:')
      print(DecryptionResult.publicKeyString)

      print('The signature public key ID:')
      print(cryptico.publicKeyID(DecryptionResult.publicKeyString))
    </script>
  </head>
  <body style="font-family: monospace; white-space: pre"></body>
</html>
